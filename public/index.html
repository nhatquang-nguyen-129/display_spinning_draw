<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quay sá»‘ may máº¯n</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      margin: 0;
      text-align: center;
      font-family: 'Segoe UI', sans-serif;
      background-color: #000;
      color: #fff;
      overflow: hidden;
    }
    .banner {
      width: 100%;
      height: auto;
    }
    h1 {
      margin-top: 10px;
      font-size: 2rem;
      color: #ffcc00;
      letter-spacing: 2px;
    }
    .display-area {
      margin-top: 60px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    .stt {
      font-size: 2rem;
      opacity: 0;
      transition: opacity 0.8s ease;
    }
    .phone {
      font-size: 3rem;
      opacity: 0;
      transition: opacity 0.8s ease;
    }
    .winner {
      font-size: 4rem;
      font-weight: bold;
      color: #ff6600;
      opacity: 0;
      transition: opacity 0.8s ease;
    }
    button {
      margin-top: 40px;
      font-size: 1.5rem;
      padding: 15px 40px;
      border-radius: 12px;
      border: none;
      background: #ff6600;
      color: white;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <!-- ğŸ–¼ Banner chÆ°Æ¡ng trÃ¬nh -->
  <img src="banner.png" alt="Banner chÆ°Æ¡ng trÃ¬nh" class="banner">

  <h1>ğŸ¯ QUAY Sá» MAY Máº®N ğŸ¯</h1>

  <!-- VÃ¹ng hiá»ƒn thá»‹ káº¿t quáº£ -->
  <div class="display-area">
    <div id="stt" class="stt">---</div>
    <div id="phone" class="phone">-----</div>
    <div id="winner" class="winner">---</div>
  </div>

  <!-- NÃºt báº¥m báº¯t Ä‘áº§u quay -->
  <button onclick="spin()">Báº®T Äáº¦U QUAY</button>

  <script>
    /**
     * HÃ m chÃ­nh Ä‘iá»u khiá»ƒn quÃ¡ trÃ¬nh quay sá»‘
     * TrÃ¬nh tá»±:
     *  1ï¸âƒ£ Láº¥y danh sÃ¡ch ngÆ°á»i tham gia
     *  2ï¸âƒ£ Hiá»ƒn thá»‹ hiá»‡u á»©ng quay ngáº«u nhiÃªn SÄT
     *  3ï¸âƒ£ Gá»i API /spin Ä‘á»ƒ láº¥y ngÆ°á»i trÃºng tháº­t
     *  4ï¸âƒ£ Hiá»ƒn thá»‹ STT â†’ SÄT â†’ TÃªn theo thá»© tá»±
     */
    async function spin() {
      const btn = document.querySelector("button");
      const sttDiv = document.getElementById("stt");
      const phoneDiv = document.getElementById("phone");
      const winnerDiv = document.getElementById("winner");

      btn.disabled = true;
      btn.innerText = "ğŸ² ÄANG QUAY...";

      // 1ï¸âƒ£ Láº¥y danh sÃ¡ch tá»« server
      const resList = await fetch("/participants");
      const participants = await resList.json();

      // 2ï¸âƒ£ Hiá»‡u á»©ng quay sá»‘: random SÄT cháº¡y liÃªn tá»¥c
      let counter = 0;
      const interval = setInterval(() => {
        const random = participants[Math.floor(Math.random() * participants.length)];
        const masked = random.phone.slice(0, 2) + "*****" + random.phone.slice(-3);
        phoneDiv.innerText = masked;
        counter++;
        if (counter > 15) clearInterval(interval);
      }, 100);

      // 3ï¸âƒ£ Gá»i API káº¿t quáº£ tháº­t
      const res = await fetch("/spin");
      const data = await res.json();
      const { stt, phone, name } = data.result; // { stt: "001", phone: "*893", name: "Mai Anh" }

      // 4ï¸âƒ£ Hiá»‡u á»©ng hiá»ƒn thá»‹ tuáº§n tá»±
      sttDiv.style.opacity = 0;
      phoneDiv.style.opacity = 0;
      winnerDiv.style.opacity = 0;

      setTimeout(() => {
        sttDiv.innerText = stt;
        sttDiv.style.opacity = 1;
      }, 1000);

      setTimeout(() => {
        phoneDiv.innerText = phone;
        phoneDiv.style.opacity = 1;
      }, 2000);

      setTimeout(() => {
        winnerDiv.innerText = `ğŸ‰ ChÃºc má»«ng ${name}! ğŸ‰`;
        winnerDiv.style.opacity = 1;
        btn.disabled = false;
        btn.innerText = "QUAY Láº I";
      }, 3000);
    }
  </script>
</body>
</html>
