<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quay sá»‘ may máº¯n</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- ğŸ–¼ Banner chÆ°Æ¡ng trÃ¬nh -->
  <img src="banner.png" alt="Banner chÆ°Æ¡ng trÃ¬nh" class="banner">

  <h1>QUAY Sá» MAY Máº®N</h1>

  <!-- VÃ¹ng hiá»ƒn thá»‹ káº¿t quáº£ -->
  <div class="lucky-number" id="result">???</div>

  <!-- NÃºt báº¥m báº¯t Ä‘áº§u quay -->
  <button onclick="spin()">ğŸ¯ Quay sá»‘</button>

  <script>
    /**
     * HÃ m chÃ­nh Ä‘iá»u khiá»ƒn quÃ¡ trÃ¬nh quay sá»‘
     * Gá»“m 3 bÆ°á»›c:
     *  1ï¸âƒ£ Táº¡o hiá»‡u á»©ng quay (hiá»ƒn thá»‹ SÄT ngáº«u nhiÃªn)
     *  2ï¸âƒ£ Gá»i API server Ä‘á»ƒ láº¥y káº¿t quáº£ tháº­t
     *  3ï¸âƒ£ Hiá»ƒn thá»‹ ngÆ°á»i tháº¯ng sau má»™t khoáº£ng delay
     */
    async function spin() {
      const resultDiv = document.getElementById("result");

      // 1ï¸âƒ£ Láº¥y danh sÃ¡ch SÄT tá»« server (dáº¡ng JSON)
      const resList = await fetch("/participants");
      const participants = await resList.json();

      // 2ï¸âƒ£ Hiá»ƒn thá»‹ hiá»‡u á»©ng "Ä‘ang quay"
      resultDiv.innerText = "Äang quay...";

      let counter = 0;
      const interval = setInterval(() => {
        // Chá»n ngáº«u nhiÃªn 1 ngÆ°á»i trong danh sÃ¡ch
        const random = participants[Math.floor(Math.random() * participants.length)];
        const phone = random.phone;

        // áº¨n bá»›t sá»‘ cho báº£o máº­t, vÃ­ dá»¥: 09*****123
        const masked =
          phone.slice(0, 2) + "*****" + phone.slice(-3);

        // Cáº­p nháº­t lÃªn mÃ n hÃ¬nh
        resultDiv.innerText = masked;

        // Láº·p láº¡i 15 láº§n (~1.5 giÃ¢y)
        counter++;
        if (counter > 15) clearInterval(interval);
      }, 100);

      // 3ï¸âƒ£ Gá»i API chÃ­nh Ä‘á»ƒ láº¥y ngÆ°á»i tháº¯ng
      const res = await fetch("/spin");
      const data = await res.json();

      // 4ï¸âƒ£ Hiá»ƒn thá»‹ káº¿t quáº£ tháº­t sau 1.5 giÃ¢y
      setTimeout(() => {
        resultDiv.innerText = data.result;
      }, 1500);
    }
  </script>
</body>
</html>